# PRD/TDD å®ç°å®¡è®¡æŠ¥å‘Š

> **å®¡è®¡æ—¥æœŸ**: 2025-12-16  
> **å®¡è®¡èŒƒå›´**: PRD v1.3.0 + TDD å…¨éƒ¨æ¨¡å—  
> **å®¡è®¡ç»“è®º**: é¡¹ç›®å¤„äº **Alpha é˜¶æ®µ**ï¼Œæ ¸å¿ƒéª¨æ¶å·²æ­å»ºï¼Œä½†å…³é”®åŠŸèƒ½ç¼ºå¤±ä¸¥é‡

---

## 1. åç«¯ (Go) å®¡è®¡

### 1.1 å·¥ä½œæµå¼•æ“ (Workflow Engine)

| TDD è§„èŒƒ                 | æ–‡ä»¶ä½ç½®                                | ç¬¦åˆåº¦ | å·®å¼‚åˆ†æ                               |
| ------------------------ | --------------------------------------- | ------ | -------------------------------------- |
| `Engine.Run()` DAGè°ƒåº¦å™¨ | `internal/core/workflow/engine.go`      | âœ… ç¬¦åˆ | å«å¹¶è¡Œæ‰§è¡Œã€ä¸­é—´ä»¶é’©å­ã€æš‚åœ/æ¢å¤é€»è¾‘  |
| `NodeProcessor` æ¥å£     | `internal/core/workflow/processor.go`   | âœ… ç¬¦åˆ | `Process(ctx, input, stream)` ç­¾ååŒ¹é… |
| `StartProcessor`         | `internal/core/workflow/nodes/start.go` | âš ï¸ éƒ¨åˆ† | åŸºç¡€å®ç°æœ‰ï¼Œ**ç¼ºå°‘** PDF/MD é™„ä»¶è§£æ   |
| `EndProcessor`           | `internal/core/workflow/nodes/end.go`   | âš ï¸ éƒ¨åˆ† | åŸºç¡€å®ç°æœ‰ï¼Œ**ç¼ºå°‘** LLM æ€»ç»“è°ƒç”¨      |
| `SequenceProcessor`      | âŒ æœªå®ç°                                | âŒ ç¼ºå¤± | TDD æœ‰è¯¦ç»†è®¾è®¡ï¼Œä»£ç ä¸­æ—                |
| `ParallelProcessor`      | å†…è”äº `engine.go`                      | âš ï¸ éƒ¨åˆ† | é€»è¾‘æœ‰ï¼Œæœªç‹¬ç«‹ä¸º Processor             |
| `VoteProcessor`          | âŒ æœªå®ç°                                | âŒ ç¼ºå¤± | PRD F.3.1 è¡¨å†³èŠ‚ç‚¹                     |
| `LoopProcessor`          | âŒ æœªå®ç°                                | âŒ ç¼ºå¤± | PRD F.3.1 å¾ªç¯èŠ‚ç‚¹                     |
| `FactCheckProcessor`     | âŒ æœªå®ç°                                | âŒ ç¼ºå¤± | PRD F.3.1 äº‹å®æ ¸æŸ¥èŠ‚ç‚¹                 |
| `HumanReviewProcessor`   | âŒ æœªå®ç°                                | âŒ ç¼ºå¤± | PRD F.3.1 äººç±»è£å†³èŠ‚ç‚¹                 |

### 1.2 è®°å¿†ç³»ç»Ÿ (Memory Protocol)

| TDD è§„èŒƒ (02_core/03_rag.md)       | å®ç°çŠ¶æ€                          | ç¬¦åˆåº¦     |
| ---------------------------------- | --------------------------------- | ---------- |
| ç¬¬ä¸€å±‚ï¼šéš”ç¦»åŒº (Quarantine)        | DBè¡¨ `quarantine_logs` å·²å»º       | âš ï¸ ä»…è¡¨ç»“æ„ |
| ç¬¬äºŒå±‚ï¼šå·¥ä½œè®°å¿† (Redis Hot Cache) | âŒ æœªå®ç°                          | âŒ ç¼ºå¤±     |
| ç¬¬ä¸‰å±‚ï¼šçŸ¥è¯†æ™‹å‡ (Promotion)       | âŒ æœªå®ç°                          | âŒ ç¼ºå¤±     |
| Embedding æœåŠ¡                     | `internal/core/memory/service.go` | âœ… ç¬¦åˆ     |

### 1.3 API å±‚

| æ¨¡å—                | ç«¯ç‚¹                                | å®ç°çŠ¶æ€ |
| ------------------- | ----------------------------------- | -------- |
| Groups              | CRUD `/api/v1/groups`               | âœ… å®Œæ•´   |
| Agents              | CRUD `/api/v1/agents`               | âœ… å®Œæ•´   |
| Workflows           | CRUD + Generate `/api/v1/workflows` | âœ… å®Œæ•´   |
| Sessions            | Execute/Control/Signal              | âœ… å®Œæ•´   |
| Memory              | Ingest/Query                        | âœ… å®Œæ•´   |
| **Templates**       | âŒ æ—                                 | âŒ ç¼ºå¤±   |
| **Cost Estimation** | âŒ æ—                                 | âŒ ç¼ºå¤±   |

### 1.4 LLM é›†æˆ

| ä¾›åº”å•†      | å®ç°çŠ¶æ€     |
| ----------- | ------------ |
| OpenAI      | âœ…            |
| Gemini      | âœ…            |
| DeepSeek    | âœ…            |
| DashScope   | âœ…            |
| SiliconFlow | âœ…            |
| Ollama      | âœ…            |
| Anthropic   | âš ï¸ å ä½æœªå®ç° |

---

## 2. å‰ç«¯ (React) å®¡è®¡

### 2.1 çŠ¶æ€ç®¡ç† (Zustand Stores)

| TDD è§„èŒƒ (05_frontend.md)                           | å®é™…æ–‡ä»¶             | ç¬¦åˆåº¦     | å·®å¼‚åˆ†æ                                  |
| --------------------------------------------------- | -------------------- | ---------- | ----------------------------------------- |
| `SessionState` (nodes/edges/messages/activeNodeIds) | `useSessionStore.ts` | âŒ ä¸¥é‡ç¼ºå¤± | **ä»…æœ‰ user å­—æ®µ**ï¼Œå®Œå…¨æ— æ³•æ”¯æ’‘ Run Mode |
| `LayoutState` (panelSizes/collapsed/maximized)      | `useLayoutStore.ts`  | âœ… ç¬¦åˆ     | å®Œæ•´å®ç° + persist                        |
| `ConfigState` (language/godMode)                    | `useConfigStore.ts`  | âœ… ç¬¦åˆ     |                                           |

### 2.2 ä¼šè®®å®¤å¸ƒå±€ (MeetingRoom)

| TDD è§„èŒƒ                                  | å®é™…å®ç°              | ç¬¦åˆåº¦ |
| ----------------------------------------- | --------------------- | ------ |
| ä¸‰æ å¯æ‹–æ‹½å¸ƒå±€ (`react-resizable-panels`) | `MeetingRoom.tsx`     | âœ… ç¬¦åˆ |
| å…¨å±ä¸“æ³¨æ¨¡å¼                              | `maximizedPanel` é€»è¾‘ | âœ… ç¬¦åˆ |
| é”®ç›˜å¿«æ·é”® (Cmd+1/2/3)                    | âŒ æœªå®ç°              | âŒ ç¼ºå¤± |

### 2.3 å¯¹è¯æµ (ChatPanel)

| TDD è§„èŒƒ                                | å®é™…å®ç° | ç¬¦åˆåº¦ |
| --------------------------------------- | -------- | ------ |
| é¡ºåºæ¶ˆæ¯æ¸²æŸ“                            | âœ… æœ‰     | âœ…      |
| å¹¶è¡Œæ¶ˆæ¯å¹¶æ’æ˜¾ç¤º (`ParallelMessageRow`) | âŒ æ—      | âŒ ç¼ºå¤± |
| Markdown æ¸²æŸ“ (remarkGfm)               | âœ… æœ‰     | âœ…      |
| å…¬å¼æ¸²æŸ“ (remarkMath + rehypeKatex)     | âŒ æ—      | âŒ ç¼ºå¤± |
| æ–‡æ¡£åŒå‘ç´¢å¼• (`[Ref: P3]` è·³è½¬)         | âŒ æ—      | âŒ ç¼ºå¤± |

### 2.4 å·¥ä½œæµç¼–è¾‘å™¨ (Builder)

| TDD è§„èŒƒ        | å®é™…å®ç°                           | ç¬¦åˆåº¦ |
| --------------- | ---------------------------------- | ------ |
| React Flow ç”»å¸ƒ | `WorkflowCanvas.tsx`               | âœ… ç¬¦åˆ |
| AI ç”Ÿæˆå·¥ä½œæµ   | `WorkflowEditor.tsx` Generate æŒ‰é’® | âœ… ç¬¦åˆ |
| èŠ‚ç‚¹å±æ€§é¢æ¿    | âŒ æ—                                | âŒ ç¼ºå¤± |
| æ¨¡ç‰ˆåº“ UI       | âŒ æ—                                | âŒ ç¼ºå¤± |

### 2.5 ç®¡ç†é¡µé¢

| PRD æ¨¡å—       | UI é¡µé¢ | å®ç°çŠ¶æ€ |
| -------------- | ------- | -------- |
| F.1 ç¾¤ç»„ç®¡ç†   | âŒ æ—     | âŒ ç¼ºå¤±   |
| F.2 Agent å·¥å‚ | âŒ æ—     | âŒ ç¼ºå¤±   |
| F.3.2 æ¨¡ç‰ˆåº“   | âŒ æ—     | âŒ ç¼ºå¤±   |
| F.4.4 æˆæœ¬é¢„ä¼° | âŒ æ—     | âŒ ç¼ºå¤±   |

### 2.6 å…¶ä»–åŠŸèƒ½

| åŠŸèƒ½                              | å®ç°çŠ¶æ€                   |
| --------------------------------- | -------------------------- |
| å›½é™…åŒ– (i18n)                     | âš ï¸ æ¡†æ¶æœ‰ï¼Œç¿»è¯‘å¾…å®Œå–„       |
| æš—é»‘æ¨¡å¼                          | âš ï¸ CSS ç±»æœ‰ï¼Œåˆ‡æ¢é€»è¾‘æœªå®ç° |
| äººç±»è£å†³å¼¹çª— (`HumanReviewModal`) | âŒ ç¼ºå¤±                     |

---

## 3. æ€»ç»“è¯„ä¼°

### 3.1 æ¨¡å—å®Œæˆåº¦

| æ¨¡å—             | TDD è¦†ç›–ç‡ | è¯„çº§       |
| ---------------- | ---------- | ---------- |
| åç«¯ Engine æ ¸å¿ƒ | ~70%       | ğŸŸ¡ å¯ç”¨     |
| åç«¯ API å±‚      | ~85%       | ğŸŸ¢ è‰¯å¥½     |
| åç«¯ Memory      | ~40%       | ğŸ”´ ä¸è¶³     |
| å‰ç«¯ Builder     | ~60%       | ğŸŸ¡ å¯ç”¨     |
| å‰ç«¯ Runner      | ~30%       | ğŸ”´ ä¸è¶³     |
| å‰ç«¯ ç®¡ç†é¡µé¢    | ~5%        | ğŸ”´ ä¸¥é‡ä¸è¶³ |

### 3.2 å…³é”®é˜»æ–­é¡¹ (Critical Gaps)

1. **å‰ç«¯ `useSessionStore`** ä¸¥é‡ç©ºè™šï¼Œæ— æ³•æ”¯æ’‘ Run Mode
2. **Workflow èŠ‚ç‚¹ç±»å‹** åªæœ‰ 3 ç§ï¼Œç¼ºå°‘ 6 ç§é€»è¾‘èŠ‚ç‚¹
3. **ä¸‰å±‚è®°å¿†åè®®** ä»…æœ‰ Embeddingï¼Œæ— å®Œæ•´æµç¨‹
4. **äººç±»è£å†³ (HumanReview)** å‰åç«¯å‡æœªå®ç°
5. **ç®¡ç†é¡µé¢** å‡ ä¹ç©ºç™½

### 3.3 æŠ€æœ¯å€ºåŠ¡

- [ ] `useSessionStore.ts` éœ€è¦å®Œå…¨é‡å†™
- [ ] ç¼ºå°‘ 6 ç§èŠ‚ç‚¹å¤„ç†å™¨
- [ ] ç¼ºå°‘æ¨¡ç‰ˆåº“ API å’Œ UI
- [ ] ç¼ºå°‘æˆæœ¬é¢„ä¼°æ¨¡å—
- [ ] ç¼ºå°‘é”®ç›˜å¿«æ·é”®æ”¯æŒ
