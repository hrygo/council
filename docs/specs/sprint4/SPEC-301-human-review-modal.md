# SPEC-301: HumanReviewModal ç»„ä»¶

> **ä¼˜å…ˆçº§**: P0 | **é¢„ä¼°å·¥æ—¶**: 3h  
> **å…³è” PRD**: F.3.1 HumanReview èŠ‚ç‚¹ | **API**: human_review.md

---

## 1. è§¦å‘æ¡ä»¶

å½“æ”¶åˆ° WebSocket äº‹ä»¶ `human_review:requested` æ—¶è‡ªåŠ¨å¼¹å‡ºï¼š

```typescript
useEffect(() => {
  if (lastMessage?.event === 'human_review:requested') {
    setReviewData(lastMessage.data);
    setModalOpen(true);
  }
}, [lastMessage]);
```

---

## 2. å¼¹çª—å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ›¡ï¸ éœ€è¦äººç±»è£å†³                              â±ï¸ 28:42  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ AI å·²ç”Ÿæˆå†³ç­–è‰æ¡ˆï¼Œè¯·ä»”ç»†å®¡æŸ¥ã€‚æ‚¨å…·æœ‰æœ€ç»ˆå†³å®šæƒã€‚      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æŠ•ç¥¨ç»“æœ:                                               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚ â”‚ âœ… CEO   â”‚ â”‚ âŒ CFO   â”‚ â”‚ âšª CTO   â”‚                 â”‚
â”‚ â”‚ åŒæ„     â”‚ â”‚ åå¯¹     â”‚ â”‚ å¼ƒæƒ     â”‚                 â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ## å†³ç­–è‰æ¡ˆ                                             â”‚
â”‚                                                         â”‚
â”‚ æ ¹æ®ä¸‰ä½ Agent çš„è®¨è®ºï¼Œæ ¸å¿ƒç»“è®ºå¦‚ä¸‹ï¼š                  â”‚
â”‚ 1. å¸‚åœºæœºä¼šçœŸå®å­˜åœ¨                                    â”‚
â”‚ 2. æŠ€æœ¯æ–¹æ¡ˆå¯è¡Œ...                                     â”‚
â”‚                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     [é©³å›] [ä¿®æ”¹] [ç­¾ç½²å¹¶é€šè¿‡]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. ä¸‰ç§æ¨¡å¼

```typescript
type ReviewMode = 'view' | 'edit' | 'reject';

const [mode, setMode] = useState<ReviewMode>('view');
```

### View Mode
- åªè¯»å±•ç¤ºè‰æ¡ˆ
- æ˜¾ç¤ºæŠ•ç¥¨ç»“æœ (å¦‚æœ‰)

### Edit Mode
- å¯ç¼–è¾‘è‰æ¡ˆå†…å®¹
- Markdown ç¼–è¾‘å™¨

### Reject Mode
- è¾“å…¥é©³å›ç†ç”±

---

## 4. è¶…æ—¶å€’è®¡æ—¶

```tsx
const TimeoutIndicator: FC<{ expiresAt: string }> = ({ expiresAt }) => {
  const [remaining, setRemaining] = useState(0);
  
  useEffect(() => {
    const timer = setInterval(() => {
      const diff = new Date(expiresAt).getTime() - Date.now();
      setRemaining(Math.max(0, Math.floor(diff / 1000)));
    }, 1000);
    return () => clearInterval(timer);
  }, [expiresAt]);
  
  const minutes = Math.floor(remaining / 60);
  const seconds = remaining % 60;
  
  return (
    <div className={cn(
      "text-sm font-mono",
      remaining < 300 && "text-red-500 animate-pulse"
    )}>
      â±ï¸ {minutes}:{seconds.toString().padStart(2, '0')}
    </div>
  );
};
```

---

## 5. API è°ƒç”¨

```typescript
const submitReview = async (data: {
  review_id: string;
  action: 'approve' | 'modify' | 'reject';
  modified_content?: string;
  rejection_reason?: string;
}) => {
  await fetch(`/api/v1/sessions/${sessionId}/review`, {
    method: 'POST',
    body: JSON.stringify(data),
  });
};
```

---

## 6. æµ‹è¯•è¦ç‚¹

- [ ] WebSocket äº‹ä»¶è§¦å‘å¼¹çª—
- [ ] ä¸‰ç§æ¨¡å¼åˆ‡æ¢
- [ ] æäº¤æˆåŠŸå…³é—­
- [ ] è¶…æ—¶è­¦å‘Šæ˜¾ç¤º
