# ç¾¤ç»„ç®¡ç†

<cite>
**æœ¬æ–‡æ¡£å¼•ç”¨çš„æ–‡ä»¶**
- [group.go](file://internal/api/handler/group.go)
- [entity.go](file://internal/core/group/entity.go)
- [repository.go](file://internal/core/group/repository.go)
- [group_repository.go](file://internal/infrastructure/persistence/group_repository.go)
- [main.go](file://cmd/council/main.go)
- [group.ts](file://frontend/src/types/group.ts)
- [group_test.go](file://internal/api/handler/group_test.go)
- [SPEC-101-groups-page.md](file://docs/specs/sprint2/SPEC-101-groups-page.md)
- [04_group_management.md](file://docs/tdd/02_core/04_group_management.md)
- [SPEC-602-default-group.md](file://docs/specs/sprint6/SPEC-602-default-group.md)
</cite>

## ç›®å½•
1. [ç®€ä»‹](#ç®€ä»‹)
2. [ç¾¤ç»„å¯¹è±¡ç»“æ„](#ç¾¤ç»„å¯¹è±¡ç»“æ„)
3. [RESTful API ç«¯ç‚¹](#restful-api-ç«¯ç‚¹)
4. [ä¸šåŠ¡é€»è¾‘ä¸å®ç°](#ä¸šåŠ¡é€»è¾‘ä¸å®ç°)
5. [è¯·æ±‚ç¤ºä¾‹](#è¯·æ±‚ç¤ºä¾‹)
6. [é”™è¯¯å¤„ç†](#é”™è¯¯å¤„ç†)
7. [å‰ç«¯é›†æˆ](#å‰ç«¯é›†æˆ)
8. [æµ‹è¯•ä¸éªŒè¯](#æµ‹è¯•ä¸éªŒè¯)
9. [ç»“è®º](#ç»“è®º)

## ç®€ä»‹
ç¾¤ç»„ç®¡ç†æ¨¡å—æ˜¯æœ¬ç³»ç»Ÿçš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ï¼Œç”¨äºå®ç°å¤šæ™ºèƒ½ä½“åä½œçš„åœºæ™¯éš”ç¦»å’Œä¸Šä¸‹æ–‡ç®¡ç†ã€‚è¯¥æ¨¡å—æä¾›äº†ä¸€å¥—å®Œæ•´çš„RESTful APIï¼Œæ”¯æŒå¯¹ç¾¤ç»„èµ„æºçš„å¢åˆ æ”¹æŸ¥æ“ä½œã€‚ç¾¤ç»„ï¼ˆGroupï¼‰ä½œä¸ºåä½œçš„åŸºæœ¬å•å…ƒï¼Œå®šä¹‰äº†æ™ºèƒ½ä½“åä½œçš„ä¸Šä¸‹æ–‡ã€é»˜è®¤æˆå‘˜å’Œè¡Œä¸ºå‡†åˆ™ã€‚æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº†ç¾¤ç»„ç®¡ç†APIçš„è®¾è®¡ã€å®ç°å’Œä½¿ç”¨æ–¹æ³•ã€‚

## ç¾¤ç»„å¯¹è±¡ç»“æ„
ç¾¤ç»„å¯¹è±¡ï¼ˆGroupï¼‰æ˜¯ç³»ç»Ÿä¸­çš„æ ¸å¿ƒæ•°æ®å®ä½“ï¼Œç”¨äºè¡¨ç¤ºä¸€ä¸ªåä½œé¡¹ç›®æˆ–ä¸Šä¸‹æ–‡ã€‚å…¶ç»“æ„å®šä¹‰äº†ç¾¤ç»„çš„åŸºæœ¬å±æ€§å’Œå…ƒæ•°æ®ã€‚

```mermaid
classDiagram
class Group {
+uuid.UUID ID
+string Name
+*string Icon
+*string SystemPrompt
+[]uuid.UUID DefaultAgentIDs
+time.Time CreatedAt
+time.Time UpdatedAt
}
```

**å›¾ç¤ºæ¥æº**
- [entity.go](file://internal/core/group/entity.go#L9-L18)

### å±æ€§è¯´æ˜
- **ID**: ç¾¤ç»„çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œä½¿ç”¨UUIDæ ¼å¼
- **Name**: ç¾¤ç»„åç§°ï¼Œç”¨äºæ ‡è¯†å’Œæ˜¾ç¤º
- **Icon**: å¯é€‰çš„ç¾¤ç»„å›¾æ ‡ï¼Œå¯ä»¥æ˜¯URLæˆ–emoji
- **SystemPrompt**: ç¾¤ç»„çš„ç³»ç»Ÿæç¤ºï¼Œå®šä¹‰äº†ç¾¤ç»„çš„åä½œåŸåˆ™å’Œè¡Œä¸ºå‡†åˆ™
- **DefaultAgentIDs**: é»˜è®¤æ™ºèƒ½ä½“IDåˆ—è¡¨ï¼ŒæŒ‡å®šäº†ç¾¤ç»„çš„åˆå§‹æˆå‘˜
- **CreatedAt**: åˆ›å»ºæ—¶é—´æˆ³
- **UpdatedAt**: æœ€åæ›´æ–°æ—¶é—´æˆ³

## RESTful API ç«¯ç‚¹
ç¾¤ç»„ç®¡ç†APIæä¾›äº†ä¸€å¥—æ ‡å‡†çš„RESTfulæ¥å£ï¼Œç”¨äºå¯¹ç¾¤ç»„èµ„æºè¿›è¡Œæ“ä½œã€‚æ‰€æœ‰ç«¯ç‚¹å‡ä½äº`/api/v1/groups`è·¯å¾„ä¸‹ã€‚

| æ–¹æ³• | ç«¯ç‚¹ | æè¿° |
| ---- | ---- | ---- |
| `POST` | `/api/v1/groups` | åˆ›å»ºæ–°ç¾¤ç»„ |
| `GET` | `/api/v1/groups` | è·å–ç¾¤ç»„åˆ—è¡¨ |
| `GET` | `/api/v1/groups/:id` | è·å–ç‰¹å®šç¾¤ç»„ |
| `PUT` | `/api/v1/groups/:id` | æ›´æ–°ç¾¤ç»„ä¿¡æ¯ |
| `DELETE` | `/api/v1/groups/:id` | åˆ é™¤ç¾¤ç»„ |

```mermaid
sequenceDiagram
participant Client as "å®¢æˆ·ç«¯"
participant Handler as "GroupHandler"
participant Repository as "Repository"
Client->>Handler : POST /api/v1/groups
Handler->>Handler : ShouldBindJSON()
Handler->>Repository : Create()
Repository-->>Handler : è¿”å›ç»“æœ
Handler-->>Client : 201 Created
Client->>Handler : GET /api/v1/groups
Handler->>Repository : List()
Repository-->>Handler : è¿”å›ç¾¤ç»„åˆ—è¡¨
Handler-->>Client : 200 OK
Client->>Handler : GET /api/v1/groups/{id}
Handler->>Handler : Parse UUID
Handler->>Repository : GetByID()
Repository-->>Handler : è¿”å›ç¾¤ç»„
Handler-->>Client : 200 OK
Client->>Handler : PUT /api/v1/groups/{id}
Handler->>Handler : Parse UUID
Handler->>Handler : ShouldBindJSON()
Handler->>Repository : Update()
Repository-->>Handler : è¿”å›ç»“æœ
Handler-->>Client : 200 OK
Client->>Handler : DELETE /api/v1/groups/{id}
Handler->>Handler : Parse UUID
Handler->>Repository : Delete()
Repository-->>Handler : è¿”å›ç»“æœ
Handler-->>Client : 204 No Content
```

**å›¾ç¤ºæ¥æº**
- [group.go](file://internal/api/handler/group.go)
- [main.go](file://cmd/council/main.go#L111-L116)

**æœ¬èŠ‚æ¥æº**
- [group.go](file://internal/api/handler/group.go)
- [main.go](file://cmd/council/main.go#L111-L116)
- [04_group_management.md](file://docs/tdd/02_core/04_group_management.md#L37-L45)

## ä¸šåŠ¡é€»è¾‘ä¸å®ç°
ç¾¤ç»„ç®¡ç†çš„ä¸šåŠ¡é€»è¾‘é€šè¿‡åˆ†å±‚æ¶æ„å®ç°ï¼ŒåŒ…æ‹¬å¤„ç†å±‚ï¼ˆHandlerï¼‰ã€æ ¸å¿ƒé€»è¾‘å±‚ï¼ˆCoreï¼‰å’ŒæŒä¹…åŒ–å±‚ï¼ˆPersistenceï¼‰ã€‚

### å¤„ç†å±‚ï¼ˆHandlerï¼‰
`GroupHandler`ç»“æ„ä½“è´Ÿè´£å¤„ç†HTTPè¯·æ±‚ï¼Œè¿›è¡Œå‚æ•°éªŒè¯å’Œå“åº”æ ¼å¼åŒ–ã€‚å®ƒé€šè¿‡ä¾èµ–æ³¨å…¥æ¥æ”¶`Repository`æ¥å£çš„å®ç°ã€‚

```mermaid
classDiagram
class GroupHandler {
-Repository repo
+Create(c *gin.Context)
+Get(c *gin.Context)
+List(c *gin.Context)
+Update(c *gin.Context)
+Delete(c *gin.Context)
}
class Repository {
<<interface>>
+Create(ctx context.Context, group *Group) error
+GetByID(ctx context.Context, id uuid.UUID) (*Group, error)
+List(ctx context.Context) ([]*Group, error)
+Update(ctx context.Context, group *Group) error
+Delete(ctx context.Context, id uuid.UUID) error
}
GroupHandler --> Repository : "ä¾èµ–"
```

**å›¾ç¤ºæ¥æº**
- [group.go](file://internal/api/handler/group.go#L11-L13)
- [repository.go](file://internal/core/group/repository.go#L9-L15)

### æŒä¹…åŒ–å±‚ï¼ˆPersistenceï¼‰
`GroupRepository`å®ç°äº†`Repository`æ¥å£ï¼Œä½¿ç”¨PostgreSQLæ•°æ®åº“è¿›è¡Œæ•°æ®æŒä¹…åŒ–ã€‚å®ƒé€šè¿‡SQLæŸ¥è¯¢ä¸æ•°æ®åº“äº¤äº’ã€‚

```mermaid
flowchart TD
A[Create] --> B["INSERT INTO groups"]
C[GetByID] --> D["SELECT ... WHERE id = $1"]
E[List] --> F["SELECT ... ORDER BY created_at DESC"]
G[Update] --> H["UPDATE groups SET ... WHERE id = $6"]
I[Delete] --> J["DELETE FROM groups WHERE id = $1"]
```

**å›¾ç¤ºæ¥æº**
- [group_repository.go](file://internal/infrastructure/persistence/group_repository.go)

### åˆ›å»ºç¾¤ç»„æ—¶çš„æ™ºèƒ½ä½“éªŒè¯
åœ¨åˆ›å»ºç¾¤ç»„æ—¶ï¼Œç³»ç»Ÿä¼šéªŒè¯æ™ºèƒ½ä½“IDçš„æœ‰æ•ˆæ€§ã€‚è™½ç„¶æ ¸å¿ƒå¤„ç†å±‚ä¸ç›´æ¥éªŒè¯æ™ºèƒ½ä½“IDï¼Œä½†é€šè¿‡æ•°æ®åº“å¤–é”®çº¦æŸç¡®ä¿å¼•ç”¨å®Œæ•´æ€§ã€‚æ­¤å¤–ï¼ŒTDDæ–‡æ¡£ä¸­æåˆ°çš„ä¸šåŠ¡è§„åˆ™è¦æ±‚é»˜è®¤ç­åº•å¿…é¡»ä¸º3ä½æ™ºèƒ½ä½“ã€‚

```mermaid
flowchart TD
Start([åˆ›å»ºç¾¤ç»„]) --> ValidateInput["éªŒè¯è¾“å…¥æ•°æ®"]
ValidateInput --> InputValid{"è¾“å…¥æœ‰æ•ˆ?"}
InputValid --> |å¦| ReturnError["è¿”å›400é”™è¯¯"]
InputValid --> |æ˜¯| CheckAgentCount["æ£€æŸ¥æ™ºèƒ½ä½“æ•°é‡"]
CheckAgentCount --> AgentCountValid{"æ™ºèƒ½ä½“æ•°é‡=3?"}
AgentCountValid --> |å¦| ReturnError
AgentCountValid --> |æ˜¯| SaveToDB["ä¿å­˜åˆ°æ•°æ®åº“"]
SaveToDB --> GenerateID["ç”ŸæˆUUID"]
GenerateID --> SetTimestamps["è®¾ç½®åˆ›å»º/æ›´æ–°æ—¶é—´"]
SetTimestamps --> ReturnSuccess["è¿”å›201 Created"]
```

**å›¾ç¤ºæ¥æº**
- [04_group_management.md](file://docs/tdd/02_core/04_group_management.md#L28-L34)
- [group_repository.go](file://internal/infrastructure/persistence/group_repository.go#L23-L43)

### åˆ é™¤ç¾¤ç»„æ—¶çš„çº§è”å¤„ç†
åˆ é™¤ç¾¤ç»„æ—¶ï¼Œç³»ç»Ÿé‡‡ç”¨çº§è”åˆ é™¤ç­–ç•¥ï¼Œç¡®ä¿ç›¸å…³æ•°æ®çš„ä¸€è‡´æ€§ã€‚æ ¹æ®TDDæ–‡æ¡£ï¼Œåˆ é™¤ç¾¤ç»„ä¼šåŒæ—¶åˆ é™¤ç›¸å…³çš„è®°å¿†æ•°æ®ã€‚

```mermaid
flowchart TD
A[åˆ é™¤ç¾¤ç»„] --> B["DELETE FROM groups WHERE id = $1"]
B --> C{åˆ é™¤æˆåŠŸ?}
C --> |æ˜¯| D["DELETE FROM memories WHERE group_id = $1"]
D --> E["DELETE FROM sessions WHERE group_id = $1"]
E --> F[è¿”å›204 No Content]
C --> |å¦| G[è¿”å›500é”™è¯¯]
```

**å›¾ç¤ºæ¥æº**
- [04_group_management.md](file://docs/tdd/02_core/04_group_management.md#L45)
- [group_repository.go](file://internal/infrastructure/persistence/group_repository.go#L109-L113)

## è¯·æ±‚ç¤ºä¾‹
ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„APIä½¿ç”¨ç¤ºä¾‹ã€‚

### åˆ›å»ºè¯„å®¡ç¾¤ç»„
åˆ›å»ºä¸€ä¸ªåŒ…å«"äº§å“ç»ç†"å’Œ"æ¶æ„å¸ˆ"æ™ºèƒ½ä½“çš„è¯„å®¡ç¾¤ç»„ã€‚

```json
POST /api/v1/groups
Content-Type: application/json

{
  "name": "äº§å“è¯„å®¡å§”å‘˜ä¼š",
  "icon": "ğŸ¢",
  "system_prompt": "ä½ æ˜¯ä¸€ä¸ªäº§å“è¯„å®¡å§”å‘˜ä¼šï¼Œè´Ÿè´£è¯„ä¼°æ–°äº§å“çš„å¯è¡Œæ€§å’Œå¸‚åœºæ½œåŠ›ã€‚",
  "default_agent_ids": [
    "product_manager_uuid",
    "architect_uuid"
  ]
}
```

**æœ¬èŠ‚æ¥æº**
- [group.ts](file://frontend/src/types/group.ts)
- [CreateGroupModal.tsx](file://frontend/src/features/groups/components/CreateGroupModal.tsx)

### è·å–ç¾¤ç»„åˆ—è¡¨
è·å–æ‰€æœ‰ç¾¤ç»„çš„åˆ—è¡¨ã€‚

```http
GET /api/v1/groups
Accept: application/json
```

å“åº”ç¤ºä¾‹ï¼š
```json
[
  {
    "id": "a1b2c3d4-e5f6-7890-g1h2-i3j4k5l6m7n8",
    "name": "The Council",
    "icon": "ğŸ¤–",
    "system_prompt": "# The Council - å¤šæ™ºèƒ½ä½“åä½œæ²»ç†ä½“...",
    "default_agent_ids": [
      "system_affirmative",
      "system_negative",
      "system_adjudicator"
    ],
    "created_at": "2025-12-21T10:00:00Z",
    "updated_at": "2025-12-21T10:00:00Z"
  }
]
```

## é”™è¯¯å¤„ç†
APIå®ç°äº†å…¨é¢çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œç¡®ä¿å®¢æˆ·ç«¯èƒ½å¤Ÿè·å¾—æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯ã€‚

```mermaid
flowchart TD
A[è¯·æ±‚] --> B{å‚æ•°éªŒè¯}
B --> |å¤±è´¥| C[è¿”å›400 Bad Request]
B --> |æˆåŠŸ| D{ä¸šåŠ¡é€»è¾‘å¤„ç†}
D --> |å¤±è´¥| E[è¿”å›500 Internal Server Error]
D --> |æˆåŠŸ| F[è¿”å›æˆåŠŸçŠ¶æ€ç ]
G[GET /groups/{id}] --> H{IDæ ¼å¼éªŒè¯}
H --> |æ— æ•ˆ| I[è¿”å›400 Bad Request]
H --> |æœ‰æ•ˆ| J{ç¾¤ç»„æ˜¯å¦å­˜åœ¨}
J --> |ä¸å­˜åœ¨| K[è¿”å›404 Not Found]
```

**æœ¬èŠ‚æ¥æº**
- [group.go](file://internal/api/handler/group.go)
- [group_test.go](file://internal/api/handler/group_test.go)

## å‰ç«¯é›†æˆ
å‰ç«¯é€šè¿‡`useGroups` Hookä¸ç¾¤ç»„ç®¡ç†APIè¿›è¡Œäº¤äº’ï¼Œæä¾›äº†åˆ›å»ºã€è¯»å–ã€æ›´æ–°å’Œåˆ é™¤ç¾¤ç»„çš„åŠŸèƒ½ã€‚

```mermaid
classDiagram
class Group {
id : string
name : string
icon : string
system_prompt : string
default_agent_ids : string[]
created_at : string
updated_at : string
}
class CreateGroupInput {
name : string
icon? : string
system_prompt? : string
default_agent_ids? : string[]
}
class UseGroups {
+useGroups() : { data, loading, error, createGroup, updateGroup, deleteGroup }
}
UseGroups --> Group : "è¿”å›"
UseGroups --> CreateGroupInput : "æ¥æ”¶"
```

**å›¾ç¤ºæ¥æº**
- [group.ts](file://frontend/src/types/group.ts)
- [useGroups.ts](file://frontend/src/hooks/useGroups.ts)

## æµ‹è¯•ä¸éªŒè¯
ç³»ç»Ÿæä¾›äº†å…¨é¢çš„å•å…ƒæµ‹è¯•ï¼Œç¡®ä¿ç¾¤ç»„ç®¡ç†åŠŸèƒ½çš„æ­£ç¡®æ€§ã€‚

```mermaid
flowchart TD
A[TestGroupHandler_Create] --> B["æµ‹è¯•æˆåŠŸåˆ›å»º"]
A --> C["æµ‹è¯•åˆ›å»ºé”™è¯¯"]
A --> D["æµ‹è¯•æ— æ•ˆJSON"]
E[TestGroupHandler_Get] --> F["æµ‹è¯•æ— æ•ˆID"]
E --> G["æµ‹è¯•æ‰¾åˆ°ç¾¤ç»„"]
E --> H["æµ‹è¯•ç¾¤ç»„æœªæ‰¾åˆ°"]
I[TestGroupHandler_List] --> J["æµ‹è¯•è·å–åˆ—è¡¨"]
I --> K["æµ‹è¯•ä»“åº“é”™è¯¯"]
L[TestGroupHandler_Update] --> M["æµ‹è¯•æ›´æ–°æˆåŠŸ"]
L --> N["æµ‹è¯•æ— æ•ˆID"]
L --> O["æµ‹è¯•æ— æ•ˆJSON"]
P[TestGroupHandler_Delete] --> Q["æµ‹è¯•åˆ é™¤æˆåŠŸ"]
P --> R["æµ‹è¯•æ— æ•ˆID"]
```

**æœ¬èŠ‚æ¥æº**
- [group_test.go](file://internal/api/handler/group_test.go)

## ç»“è®º
ç¾¤ç»„ç®¡ç†APIæä¾›äº†ä¸€å¥—å®Œæ•´ã€å¯é çš„RESTfulæ¥å£ï¼Œæ”¯æŒå¯¹ç¾¤ç»„èµ„æºçš„å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚é€šè¿‡æ¸…æ™°çš„åˆ†å±‚æ¶æ„å’Œå…¨é¢çš„æµ‹è¯•è¦†ç›–ï¼Œç¡®ä¿äº†ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯ç»´æŠ¤æ€§ã€‚APIè®¾è®¡éµå¾ªRESTåŸåˆ™ï¼Œå…·æœ‰è‰¯å¥½çš„å¯æ‰©å±•æ€§ï¼Œä¸ºå¤šæ™ºèƒ½ä½“åä½œæä¾›äº†åšå®çš„åŸºç¡€ã€‚